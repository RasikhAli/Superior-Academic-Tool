<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShadowText Studio</title>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    rel="stylesheet"
  />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/round-slider@1.6.1/dist/roundslider.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/round-slider@1.6.1/dist/roundslider.min.js"></script>


  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --accent: #4a90e2;
      --accent-dark: #357ab8;

      --bg-light: #f7f9fc;
      --bg-dark: #12121e;

      --card-light: #fff;
      --card-dark: #1f1f2e;

      --text-light: #202020;
      --text-dark: #e6e6e6;

      --shadow: rgba(0, 0, 0, 0.15);
      --shadow-dark: rgba(0, 0, 0, 0.7);
    }

    /* Reset */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s ease, color 0.3s ease;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    .angle-control .rs-handle {
        background: var(--bg-dark);
    }
    .angle-control .rs-range {
        background: var(--accent-dark);
    }

    
    .dark #angleSlider .rs-inner {
        background-color: var(--card-dark);
    }
    .dark .angle-control .rs-range-color {
        background: var(--accent-dark);
    }


    .light .angle-control .rs-path {
        background: var(--accent-dark);
    }
    .light .angle-control .rs-handle {
        background: var(--bg-light);
    }
    .light #angleSlider .rs-inner {
        background-color: var(--card-light);
    }
    .light .angle-control .rs-range-color {
        background: var(--card-dark);
    }
    

    nav {
      background: var(--accent);
      color: white;
      padding: 1.25rem 2.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 6px 15px var(--shadow-dark);
      user-select: none;
    }

    nav .title {
      font-weight: 700;
      font-size: 1.7rem;
      letter-spacing: 0.05em;
      cursor: default;
    }

    nav .actions {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    nav .actions a,
    nav .theme-toggle {
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      background: none;
      border: none;
      transition: transform 0.2s ease;
    }
    nav .actions a:hover,
    nav .theme-toggle:hover {
      transform: scale(1.1);
      color: #d4e4ff;
    }

    main {
      flex: 1;
      display: flex;
      gap: 2rem;
      padding: 3rem 4rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    body.light main {
      background: transparent;
    }
    body.dark main {
      background: transparent;
    }

    section {
      flex: 1;
      border-radius: 14px;
      padding: 2.5rem 3rem;
      box-shadow: 0 12px 30px var(--shadow);
      background: var(--card-light);
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: background 0.3s ease;
    }
    body.dark section {
      background: var(--card-dark);
      box-shadow: 0 12px 30px var(--shadow-dark);
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1.4rem;
    }

    label {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.4rem;
      user-select: none;
    }

    input[type="text"],
    input[type="color"] {
      font-size: 1.1rem;
      padding: 14px 18px;
      border-radius: 12px;
      border: 1.5px solid #c5cbd3;
      outline-offset: 2px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      font-weight: 500;
      font-family: inherit;
      color: inherit;
      background: transparent;
    }
    input[type="text"]::placeholder {
      color: #a3a9b4;
      font-weight: 400;
    }
    input[type="text"]:focus,
    input[type="color"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 8px var(--accent);
    }

    /* New styles for color inputs to look modern and gradient-y */
    input[type="color"] {
    --webkit-appearance: none;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    padding: 0;
    background: transparent;
    position: relative;
    transition: box-shadow 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
    border-radius: 50%;
    background: none !important;
    }

    input[type="color"]::-webkit-color-swatch {
    border-radius: 50%;
    border: none;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    /* Make input bigger on focus */
    input[type="color"]:focus {
    outline: none;
    box-shadow: 0 0 8px var(--accent);
    transform: scale(1.1);
    }

    /* Add gradient backgrounds behind each input for top and bottom */
    #color_top {
    background-image: linear-gradient(to bottom, #3a678a, #213345);
    }

    #color_bottom {
    background-image: linear-gradient(to bottom, #213345, #3a678a);
    }

    .color-row {
        display: flex;
        gap: 1.5rem; /* space between the two color inputs */
        align-items: center;
    }

    .color-input-group {
        display: flex;
        flex-direction: column;
        flex: 1; /* make both inputs take equal space */
    }

    /* Optional: make label smaller so it doesn't take too much vertical space */
    .color-input-group label {
        margin-bottom: 0.4rem;
        font-weight: 600;
        font-size: 1rem;
    }


    button[type="submit"] {
      margin-top: 1.5rem;
      padding: 14px 0;
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
      background: var(--accent);
      border: none;
      border-radius: 14px;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(74,144,226,0.65);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      user-select: none;
    }
    button[type="submit"]:hover {
      background-color: var(--accent-dark);
      box-shadow: 0 8px 18px rgba(53,122,184,0.8);
    }

    .output {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.8rem;
      user-select: none;
    }

    .output h3 {
      font-weight: 600;
      font-size: 1.4rem;
      color: var(--accent);
      margin-bottom: 0;
    }

    .output img {
      max-width: 100%;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      user-select: none;
      transition: transform 0.3s ease;
    }
    .output img:hover {
      transform: scale(1.03);
    }

    .download-btn {
      padding: 14px 24px;
      font-size: 1.1rem;
      border-radius: 14px;
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(74,144,226,0.65);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    .download-btn:hover {
      background-color: var(--accent-dark);
      box-shadow: 0 8px 18px rgba(53,122,184,0.8);
    }
    

    @media (max-width: 960px) {
      main {
        flex-direction: column;
        padding: 2rem 1.5rem;
      }
      section {
        padding: 2rem 1.5rem;
      }
    }
  </style>
</head>
<body class="light">
  <nav>
    <div class="title" aria-label="Website title">üåü ShadowText Studio</div>
    <div class="actions">
        <a href="https://github.com/rasikhali" target="_blank" rel="noopener" aria-label="GitHub" title="GitHub">
        GitHub
        </a>
        <a href="https://linkedin.com/in/rasikhali" target="_blank" rel="noopener" aria-label="LinkedIn" title="LinkedIn">
        LinkedIn
        </a>
        <button
        class="theme-toggle"
        aria-label="Toggle Theme"
        title="Toggle Light/Dark Mode"
        onclick="toggleTheme()"
        type="button"
        >üåô</button>
    </div>
    </nav>
  <main>
    <section aria-label="Input Form">
      <form method="post" novalidate>
        <label for="name">Your Name</label>
        <textarea
        id="name"
        name="name"
        placeholder="e.g. RASIKH ALI"
        rows="3"
        required
        autocomplete="off"
        spellcheck="false"
        style="font-family: inherit; font-size: 1.1rem; padding: 14px 18px; border-radius: 12px; border: 1.5px solid #c5cbd3; outline-offset: 2px; resize: vertical;"
        ></textarea>


        <div class="color-row">
        <div class="color-input-group">
            <label for="color_top">Top Gradient Color</label>
            <input id="color_top" name="color_top" type="color" value="#8C1F7A" />
        </div>
        <div class="color-input-group">
            <label for="color_bottom">Bottom Gradient Color</label>
            <input id="color_bottom" name="color_bottom" type="color" value="#DD64C8" />
        </div>
        </div>


        <label for="alpha">Shadow Alpha</label>
        <input id="alpha" name="alpha" type="range" min="0" max="100" step="0.01" value="1" />

        <label for="angleSlider">Shadow Angle (<span id="angleValue">45¬∞</span>)</label>

        <center>
            <div id="angleSlider" class="angle-control"></div>
            <input type="hidden" id="angle" name="angle" value="45" />
        </center>
        

        
        <input type="hidden" name="theme" id="themeInput" value="light" />
        
        <button formaction="/download" formmethod="get" type="submit" class="download-btn" aria-label="Download Generated Image" style="margin-top: 1.5rem;" >
            Download
        </button>
        <button formaction="/Crop" formmethod="get" type="submit" class="crop-btn" aria-label="Crop and Download Generated Image" style="margin-top: 1.5rem;" >
            Crop and Download
        </button>

      </form>
    </section>

    <section aria-label="Generated Output" class="output">
        <img id="generatedImage" src="" alt="Generated shadow text image" draggable="false" />
    </section>

  </main>

  <script>
    const form = document.querySelector("form");
    const inputs = form.querySelectorAll("input, textarea");  // include textarea now
    const angleSlider = document.getElementById("angleSlider");
    const image = document.getElementById("generatedImage");

    // Debounce function to limit requests
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }

    async function generateImage() {
        const formData = new FormData(form);
        const data = {};
        
        // Collect all form inputs
        formData.forEach((v, k) => {
            if (k === 'name') {
                data[k] = v.replace(/\r?\n/g, '\n');  // normalize newlines
            } else {
                data[k] = v;
            }
        });

        // Get angleSlider value (it's stored in the hidden input with id="angle")
        const angleValue = document.getElementById("angle").value;
        data.angle = angleValue;
        

        try {
            const response = await fetch("/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            if (response.ok) {
                const json = await response.json();
                image.src = json.image_path + "?t=" + Date.now(); // cache bust
            } else {
                console.error("Failed to generate image");
            }
        } catch (e) {
            console.error(e);
        }
    }


    const debouncedGenerate = debounce(generateImage, 300);

    inputs.forEach(input => {
        input.addEventListener("input", () => {
            debouncedGenerate();
        });
    });

    function toggleTheme() {
        const body = document.body;
        const themeInput = document.getElementById("themeInput");
        const toggleBtn = document.querySelector(".theme-toggle");

        if (body.classList.contains("light")) {
            // Switch to dark
            body.classList.remove("light");
            body.classList.add("dark");
            themeInput.value = "dark";
            toggleBtn.textContent = "‚òÄÔ∏è"; // sun emoji for dark mode
        } else {
            // Switch to light
            body.classList.remove("dark");
            body.classList.add("light");
            themeInput.value = "light";
            toggleBtn.textContent = "üåô"; // moon emoji for light mode
        }

        // Optional: regenerate image or save theme preference here if needed
    }


    // Prevent form submission reload
    // form.addEventListener("submit", (e) => e.preventDefault());
    $("#angleSlider").roundSlider({
        sliderType: "min-range",
        // handleShape: "round",
        width: 16,
        // radius: 60,
        value: 45,
        min: 0,
        max: 360,
        // circleShape: "full",  // or "full" for full 360¬∞
        startAngle: 180,
        borderColor: "red",
        drag: function(e) {
            // Update hidden input and label text live while dragging
            document.getElementById("angle").value = e.value;
            document.getElementById("angleValue").textContent = e.value + "¬∞";
            debouncedGenerate();
        },
        change: function(e) {
            // Update hidden input and label text after change (optional)
            document.getElementById("angle").value = e.value;
            document.getElementById("angleValue").textContent = e.value + "¬∞";
            debouncedGenerate();
        }
    });

    // Initialize with default values on page load
    window.onload = () => {
        generateImage();

        const theme = "{{ theme or 'dark' }}";
        if (theme === "dark") {
            document.body.classList.add("dark");
            document.body.classList.remove("light");
            document.getElementById("themeInput").value = "dark";
            document.querySelector(".theme-toggle").textContent = "‚òÄÔ∏è";
        } else {
            document.body.classList.add("light");
            document.body.classList.remove("dark");
            document.getElementById("themeInput").value = "light";
            document.querySelector(".theme-toggle").textContent = "üåô";
        }
    };

</script>
</body>
</html>
